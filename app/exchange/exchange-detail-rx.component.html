<!--
    Reactive version of the Exchange Details form.
 -->
<div *ngIf="exchange" class="container module-bootstrap">
    <h2>{{exchange.id}} Exchange Details</h2>

    <form *ngIf="active" novalidate [formGroup]="exchangeDetailsForm" (ngSubmit)="save()">

        <div class="form-group">
            <label for="exchangeId">Id:</label>
            <input formControlName="exchangeId" id="exchangeId" type="text" class="form-control"/>
        </div>

        <div class="form-group">
            <label for="adapter">Adapter:</label>
            <input formControlName="adapter" placeholder="com.my.ExchangeAdapter" id="adapter" type="text"
                   class="form-control" maxlength="121" required/>

            <!--<div *ngIf="!exchangeDetailsForm.controls.adapter.valid" class="alert alert-danger">-->
            <!--Adapter name is required.-->
            <!--</div>-->
            <div *ngIf="formErrors.adapter" class="alert alert-danger">{{ formErrors.adapter }}</div>

        </div>
        <!--<h3>Network Config</h3>-->
        <div class="form-group">
            <label for="connectionTimeout">Connection Timeout (secs):</label>
            <input id="connectionTimeout" ngControlGroup="networkConfig" formControlName="connectionTimeout" type="text"
                   class="form-control" placeholder="60" maxlength="8" required/>

            <!--<div *ngIf="!exchangeDetailsForm.controls.connectionTimeout.valid" class="alert alert-danger">-->
            <!--Connection timeout must be a whole number.-->
            <!--</div>-->
            <div *ngIf="formErrors.connectionTimeout" class="alert alert-danger">{{ formErrors.connectionTimeout }}
            </div>
            <!--<small *ngIf="!exchangeDetailsForm.controls.connectionTimeout.valid" class="text-danger">-->
            <!--Connection timeout must be a whole number.-->
            <!--</small>-->
        </div>

        <div class="row">
            <div class="col-sm-6" formArrayName="nonFatalErrorHttpStatusCodes">
                <h4>Non Fatal HTTP Status Codes</h4>
                <div *ngFor="let nonFatalErrorHttpStatusCode of nonFatalErrorHttpStatusCodes.controls; let i=index"
                     class="panel panel-default">
                    <div class="panel-heading">
                        <span>Code {{i + 1}}</span>
                        <span class="glyphicon glyphicon-remove pull-right"
                              *ngIf="nonFatalErrorHttpStatusCodes.controls.length > 1"
                              (click)="deleteErrorCode(i)"></span>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-sm-6">HTTP Status Code:</label>
                            <input class="col-sm-6" type="text" [formControlName]="i" maxlength="3" required>

                            <!--<small [hidden]="nonFatalErrorHttpStatusCodes.controls[i].valid" class="text-danger">-->
                            <!--Error Code must be 3 digit number.-->
                            <!--</small>-->
                            <div *ngIf="!nonFatalErrorHttpStatusCodes.controls[i].valid"
                                 class="alert alert-danger col-sm-6">
                                {{ formErrors.nonFatalErrorHttpStatusCodes }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="margin-20">
                    <a (click)="addErrorCode()" style="cursor: default">
                        Add error code +
                    </a>
                </div>
            </div>

            <div class="col-sm-6" formArrayName="nonFatalErrorMessages">
                <h4>Non Fatal Error Messages</h4>
                <div *ngFor="let nonFatalErrorMessage of nonFatalErrorMessages.controls; let i=index"
                     class="panel panel-default">
                    <div class="panel-heading">
                        <span>Message {{i + 1}}</span>
                        <span class="glyphicon glyphicon-remove pull-right"
                              *ngIf="nonFatalErrorMessages.controls.length > 0"
                              (click)="deleteErrorMessage(i)"></span>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label class="col-sm-5">Error Message:</label>
                            <input class="col-sm-7" type="text" [formControlName]="i" maxlength="121" required #errorMsg>
                            <div *ngIf="errorMsg.className.includes('ng-dirty') && !nonFatalErrorMessages.controls[i].valid" class="alert alert-danger col-sm-7">
                                {{ formErrors.nonFatalErrorMessages }}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="margin-20">
                    <a (click)="addErrorMessage()" style="cursor: default">
                        Add error message +
                    </a>
                </div>
            </div>
        </div>
        <div>
            <hr>
        </div>
        <div class="row">
            <div class="col-sm-2 col-sm-offset-0">

                <!-- Must have type for button else Chrome reloads entire app on Cancel click!
                     http://stackoverflow.com/questions/38120756/angular2-router-navigate-refresh-page
                 -->
                <button type="button" (click)="goToDashboard()" class="btn btn-default">Cancel</button>
                <button type="submit" class="btn btn-primary" [disabled]="!exchangeDetailsForm.valid">Save</button>
            </div>
        </div>
    </form>
</div>
