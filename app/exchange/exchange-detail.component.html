<!--
    Template-driven version of the Exchange Details form so I can decide which I like best.
 -->
<div *ngIf="exchange" class="container module-bootstrap">
    <h2>{{exchange.id}} Exchange Details</h2>

    <form *ngIf="active" #exchangeDetailsForm="ngForm" (ngSubmit)="save()">

        <div class="form-group">
            <label for="exchangeId">Id:</label>
            <input [(ngModel)]="exchange.id" name="exchangeId" id="exchangeId" type="text" class="form-control"
                   disabled/>
        </div>

        <div class="form-group">
            <label for="adapter">Adapter:</label>
            <input [(ngModel)]="exchange.adapter" name="adapter" placeholder="MyExchangeAdapter" id="adapter"
                   type="text" class="form-control" required maxlength="120"/>
            <div *ngIf="formErrors.adapter" class="alert alert-danger">{{ formErrors.adapter }}</div>
        </div>
        <h3>Network Config</h3>
        <div class="form-group">
            <label for="connectionTimeout">Connection Timeout (secs):</label>
            <input [(ngModel)]="exchange.networkConfig.connectionTimeout" id="connectionTimeout"
                   name="connectionTimeout" type="text" class="form-control" placeholder="60" required
                   pattern="\d+"/>
            <div *ngIf="formErrors.connectionTimeout" class="alert alert-danger">{{formErrors.connectionTimeout }}</div>
        </div>

        <div class="form-group">
            <label>Non Fatal HTTP Error Codes:</label>
            <ul class="items">
                <li>
                    <div class="row">
                        <div class="col-sm-6">
                            <input #httpStatusCode
                                   (keyup.enter)="addErrorCode(httpStatusCode.value); httpStatusCode.value=''"
                                   (blur)="addErrorCode(httpStatusCode.value); httpStatusCode.value=''"
                                   type="text" class="form-control" placeholder="522" pattern="\d{3}"
                                   name="newErrorCode" id="newErrorCode">
                        </div>
                        <div>
                            <button class="btn btn-success btn-xs"
                                    (click)="addErrorCode(httpStatusCode.value); httpStatusCode.value=''">
                                Add
                            </button>
                        </div>
                    </div>
                </li>
                <li *ngFor="let errorCode of exchange.networkConfig.nonFatalErrorHttpStatusCodes; let i=index;"
                    (click)="onSelectErrorCode(exchange.networkConfig.nonFatalErrorHttpStatusCodes[i])"
                    [class.selected]="exchange.networkConfig.nonFatalErrorHttpStatusCodes[i] === selectedErrorCode">
                    <div class="row">
                        <div class="col-sm-6">
                            <input [(ngModel)]="exchange.networkConfig.nonFatalErrorHttpStatusCodes[i].value"
                                   type="text" class="form-control" id="errorCode_ + {{i}}"
                                   name="errorCode_ + {{i}}" required #errorCode="ngModel" pattern="\d{3}">
                        </div>
                        <div class="col-sm-offset-6">
                            <button class="btn btn-danger btn-xs"
                                    (click)="deleteErrorCode(exchange.networkConfig.nonFatalErrorHttpStatusCodes[i]); $event.stopPropagation()">
                                Delete
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div [hidden]="errorCode.valid || errorCode.pristine" class="col-sm-6 alert alert-danger">
                            HTTP error code must be a 3 digit number.
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="form-group">
            <label>Non Fatal Error Messages:</label>
            <ul class="items">
                <li>
                    <div class="row">
                        <div class="col-sm-6">
                            <input #errorMessage
                                   (keyup.enter)="addErrorMessage(errorMessage.value); errorMessage.value=''"
                                   (blur)="addErrorMessage(errorMessage.value); errorMessage.value=''"
                                   type="text" class="form-control" name="newErrorMessage" id="newErrorMessage"
                                   placeholder="A new error message"/>
                        </div>
                        <div>
                            <button class="btn btn-success btn-xs"
                                    (click)="addErrorMessage(errorMessage.value); errorMessage.value=''">
                                Add
                            </button>
                        </div>
                    </div>
                </li>
                <li *ngFor="let errorCode of exchange.networkConfig.nonFatalErrorMessages; let i=index;"
                    (click)="onSelectErrorMessage(exchange.networkConfig.nonFatalErrorMessages[i])"
                    [class.selected]="exchange.networkConfig.nonFatalErrorMessages[i] === selectedErrorMessage">
                    <div class="row">
                        <div class="col-sm-6">
                            <input [(ngModel)]="exchange.networkConfig.nonFatalErrorMessages[i].value" type="text"
                                   class="form-control" id="errorMsg_ + {{i}}" name="errorMsg_ + {{i}}" required #errorMsg="ngModel">
                        </div>
                        <div>
                            <button class="btn btn-danger btn-xs"
                                    (click)="deleteErrorMessage(exchange.networkConfig.nonFatalErrorMessages[i]); $event.stopPropagation()">
                                Delete
                            </button>
                        </div>
                    </div>
                    <div class="row">
                        <div [hidden]="errorMsg.valid || errorMsg.pristine"
                             class="col-sm-6 alert alert-danger">
                            Error message must be set. Otherwise, please delete it.
                        </div>
                    </div>
                </li>
            </ul>
        </div>
        <div>
            <hr>
        </div>
        <div>
            <button (click)="goBack()" class="btn btn-default">Back</button>
            <button (click)="save()" class="btn btn-primary" [disabled]="!exchangeDetailsForm.form.valid">Save</button>
        </div>
    </form>
</div>
